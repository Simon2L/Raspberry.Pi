@page "/trafik"
@using global::Raspberry.Pi.Dashboard.Integration
@inject ISLApiService SLApiSerivce

<PageTitle>Trafik</PageTitle>

@if (loadError)
{
    <MudAlert Severity="Severity.Error">Failed to load depatures. Please try again later.</MudAlert>
}
<MudText Typo="Typo.h4" GutterBottom="true">@departuresResponse?.LastUpdated.ToString("HH:mm")</MudText>

<MudDataGrid Loading="@isLoading" Items="departuresResponse?.Departures">
    <Columns>
        <PropertyColumn Property="x => x.Line.TransportMode" Title="Typ" />
        <PropertyColumn Property="x => x.Destination" Title="Destination" />
        <PropertyColumn Property="x => x.Display" Title="Ankomst" />
        <PropertyColumn Property="x => x.Scheduled.ToShortTimeString()" Title="Scheduled" />
        <PropertyColumn Property="x => x.Expected.ToShortTimeString()" Title="Expected" />
        <PropertyColumn Property="x => x.Line.GroupOfLines" Title="Linje" />
    </Columns>
</MudDataGrid>

@code {
    private DeparturesResponse? departuresResponse;
    private bool isLoading = true;
    private bool loadError = false;

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(500);
        try
        {
            departuresResponse = await SLApiSerivce.GetDeparturesAsync(Sites.Zinken);
        }
        catch
        {
            loadError = true;
        }
        finally
        {
            isLoading = false;
        }
    }
}
